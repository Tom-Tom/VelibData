$(function(){function t(e){var t=new Date(e),n=t.getHours(),r=t.getMinutes(),i=t.getSeconds(),s=n+"h:"+r+"m:"+i+"s:";return s}function n(e){var n=(new Date).getTime();n-=e;return t(n)}function r(e,r,i){var s=r.position.lat,o=r.position.lng,u=r.name.slice(7),a="<strong>Address : </strong>"+r.address;a=a+"<br/><strong>Available bike stands : </strong>"+r.available_bike_stands;a=a+"<br/><strong>Available bikes : </strong>"+r.available_bikes;a=a+"<br/><strong>Last update : </strong>"+t(r.last_update);a=a+"("+n(r.last_update)+"sec ago)";var f=100*r.available_bikes/r.bike_stands,l="#333333";f<=20?l="#2B00DD":f<=40?l="#5500BB":f<=60?l="#800099":f<=80?l="#AA0077":f<=100&&(l="#D50055");if(i==="circle"){var c={color:l,opacity:.6,weight:5,fillColor:"#000000",fillOpacity:.4};L.circle(r.position,50,c).addTo(e)}else L.mapbox.markerLayer({type:"Feature",geometry:{type:"Point",coordinates:[o,s]},properties:{title:u,description:a,"marker-size":"small","marker-color":l,"marker-symbol":"bicycle"}}).addTo(e)}var e=L.mapbox.map("map","etiwiti.panam");e.attributionControl.removeFrom(e);$.ajax({url:"https://api.jcdecaux.com/vls/v1/stations?apiKey=a529d3371c450b3ab44a9281345bcb27e8f47868&contract=Paris",type:"GET",crossDomain:!0,dataType:"jsonp",success:function(t){var n="",i=t,s=0,o=0;for(var u=0;u<i.length;u++){r(e,i[u],n);s+=i[u].available_bikes;o+=i[u].available_bike_stands}},error:function(e){console.log("statut error : "+e.status+" "+e.statusText)}});setInterval(function(){$.ajax({url:"https://api.jcdecaux.com/vls/v1/stations?apiKey=a529d3371c450b3ab44a9281345bcb27e8f47868&contract=Paris",type:"GET",crossDomain:!0,dataType:"jsonp",success:function(e){localStorage.data=JSON.stringify(e)},error:function(e){console.log("statut error : "+e.status+" "+e.statusText)}})},3e3);Highcharts.setOptions({global:{useUTC:!1}});$("#graph").highcharts({chart:{type:"spline",backgroundColor:"transparent",height:"190",animation:Highcharts.svg,events:{load:function(){var e=this.series[0];setInterval(function(){var t=JSON.parse(localStorage.data),n=0,r=0;for(var i=0;i<t.length;i++){n+=t[i].available_bikes;r+=t[i].available_bike_stands}var s=n,o=(new Date).getTime();e.addPoint([o,s],!0,!0)},5e3)}}},credits:{enabled:!1},title:{text:""},xAxis:{type:"datetime",lineWidth:0,tickPixelInterval:100,labels:{style:{fontFamily:"DINPro"}}},yAxis:{title:{text:""},gridLineWidth:0,labels:{enabled:!1}},tooltip:{formatter:function(){return"<b>"+this.series.name+"</b><br/>"+Highcharts.numberFormat(this.y,2)+"<br/>le "+Highcharts.dateFormat("%Y-%m-%d %H:%M:%S",this.x)},style:{padding:10,fontFamily:"DINPro"},crosshairs:[{width:4,color:"#1b6d93"}]},plotOptions:{series:{color:"#64bee7",marker:{fillColor:"#edf5fb",lineColor:"#64bee7",lineWidth:4,states:{hover:{lineColor:"#1b6d93"}}}}},legend:{enabled:!1},exporting:{enabled:!1},series:[{name:"Nombre de velib':",lineWidth:6,marker:{radius:9},data:function(){var e=[],t=(new Date).getTime(),n,r=JSON.parse(localStorage.data),i=0;for(n=0;n<r.length;n++)i+=r[n].available_bikes;for(n=-19;n<=0;n++)e.push({x:t+n*5e3,y:i});return e}()}]});$("#timeline nav ul:nth-child(1)").on("click",function(){console.log("ALLO")})});