$(function(){Raphael.fn.drawGrid=function(e,t,n,r,i,s,o){o=o||"#000";var u=["M",Math.round(e)+.5,Math.round(t)+.5,"L",Math.round(e+n)+.5,Math.round(t)+.5,Math.round(e+n)+.5,Math.round(t+r)+.5,Math.round(e)+.5,Math.round(t+r)+.5,Math.round(e)+.5,Math.round(t)+.5],a=r/s,f=n/i;for(var l=1;l<s;l++)u=u.concat(["M",Math.round(e)+.5,Math.round(t+l*a)+.5,"H",Math.round(e+n)+.5]);for(l=1;l<i;l++)u=u.concat(["M",Math.round(e+l*f)+.5,Math.round(t)+.5,"V",Math.round(t+r)+.5]);return this.path(u.join(",")).attr({stroke:o})};$(function(){$("#data").css({position:"absolute",left:"-9999em",top:"-9999em"})});window.onload=function(){function e(e,t,n,r,i,s){var o=(n-e)/2,u=(i-n)/2,a=Math.atan((n-e)/Math.abs(r-t)),f=Math.atan((i-n)/Math.abs(r-s));a=t<r?Math.PI-a:a;f=s<r?Math.PI-f:f;var l=Math.PI/2-(a+f)%(Math.PI*2)/2,c=o*Math.sin(l+a),h=o*Math.cos(l+a),p=u*Math.sin(l+f),d=u*Math.cos(l+f);return{x1:n-c,y1:r+h,x2:n+p,y2:r+d}}var t=[],n=[];$("#data tfoot th").each(function(){t.push($(this).html())});$("#data tbody td").each(function(){n.push($(this).html())});var r=1500,i=250,s=30,o=20,u=20,a=.6,f="hsl("+[a,.5,.5]+")",l=Raphael("holder",r,i),c={font:"12px Helvetica, Arial",fill:"#64bee7"},h={font:"10px Helvetica, Arial",fill:"#64bee7"},p={font:"12px Helvetica, Arial",fill:"#64bee7"},d=(r-s)/t.length,v=Math.max.apply(Math,n),m=(i-o-u)/v,f="#8fceea",g=l.path().attr({stroke:f,"stroke-width":4,"stroke-linejoin":"round"}),y=l.path().attr({stroke:"none",opacity:0,fill:f}),b=l.set(),w=0,E=0,S=!1,x,T=l.set();b.push(l.text(60,12,"24 hits").attr(c));b.push(l.text(60,27,"22 September 2008").attr(h).attr({fill:f}));b.hide();var N=l.popup(100,100,b,"right").attr({fill:"#000",stroke:"#666","stroke-width":2,"fill-opacity":.7}).hide(),C,k;for(var L=0,A=t.length;L<A;L++){var O=Math.round(i-o-m*n[L]),M=Math.round(s+d*(L+.5)),_=l.text(M,i-6,t[L]).attr(c).toBack();if(!L){C=["M",M,O,"C",M,O];k=["M",s+d*.5,i-o,"L",M,O,"C",M,O]}if(L&&L<A-1){var D=Math.round(i-o-m*n[L-1]),P=Math.round(s+d*(L-.5)),H=Math.round(i-o-m*n[L+1]),B=Math.round(s+d*(L+1.5)),j=e(P,D,M,O,B,H);C=C.concat([j.x1,j.y1,M,O,j.x2,j.y2]);k=k.concat([j.x1,j.y1,M,O,j.x2,j.y2])}var F=l.circle(M,O,9).attr({fill:"#edf5fb",stroke:f,"stroke-width":4});T.push(l.rect(s+d*L,0,d,i-o).attr({stroke:"#333",fill:"#555",opacity:0}));var I=T[T.length-1];(function(e,t,n,i,s){var o,u=0;I.hover(function(){clearTimeout(x);var o="right";e+N.getBBox().width>r&&(o="left");var u=l.popup(e,t,b,o,1),a=Raphael.animation({path:u.path,transform:["t",u.dx,u.dy]},200*S);w=b[0].transform()[0][1]+u.dx;E=b[0].transform()[0][2]+u.dy;N.show().stop().animate(a);b[0].attr({text:n+" hit"+(n==1?"":"s")}).show().stop().animateWith(N,a,{transform:["t",w,E]},200*S);b[1].attr({text:i+" September 2008"}).show().stop().animateWith(N,a,{transform:["t",w,E]},200*S);s.attr("r",20);S=!0},function(){s.attr("r",9);x=setTimeout(function(){N.hide();b[0].hide();b[1].hide();S=!1},1)})})(M,O,n[L],t[L],F)}C=C.concat([M,O,M,O]);k=k.concat([M,O,M,O,"L",M,i-o,"z"]);g.attr({path:C});y.attr({path:k});N.toFront();b[0].toFront();b[1].toFront();T.toFront()}});